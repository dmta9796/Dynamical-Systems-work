%system parameters
G=1;
m1=1;
m2=1;
m3=1;

%two body problem
%x(1)=x(4);%rx1
%x(2)=x(5);%ry1
%x(3)=x(6);%rz1
%x(4)=-G*m2*(x(1)-x(7))/(x(1)-x(7))^(3/2)-G*m3*(x(1)-x(13))/(x(1)-x(13))^(3/2);%drx1
%x(5)=-G*m2*(x(2)-x(8))/(x(2)-x(8))^(3/2)-G*m3*(x(1)-x(14))/(x(1)-x(14))^(3/2);%dry1
%x(6)=-G*m2*(x(3)-x(9))/(x(3)-x(9))^(3/2)-G*m3*(x(1)-x(15))/(x(1)-x(15))^(3/2);%drz1
%x(7)=x(10);%rx2
%x(8)=x(11);%ry2
%x(9)=x(12);%rz2
%x(10)=-G*m1*(x(7)-x(1))/(x(7)-x(1))^(3/2)-G*m3*(x(7)-x(13))/(x(7)-x(13))^(3/2);%drx2
%x(11)=-G*m1*(x(8)-x(2))/(x(8)-x(2))^(3/2)-G*m3*(x(7)-x(14))/(x(7)-x(14))^(3/2);%dry2
%x(12)=-G*m1*(x(9)-x(3))/(x(9)-x(3))^(3/2)-G*m3*(x(7)-x(15))/(x(7)-x(15))^(3/2);%drz2
%x(13)=x(16);%rx3
%x(14)=x(17);%ry3
%x(15)=x(18);%rz3
%x(16)=-G*m1*(x(16)-x(1))/(x(16)-x(1))^(3/2)-G*m2*(x(16)-x(7))/(x(13)-x(7))^(3/2);%drx3
%x(17)=-G*m1*(x(17)-x(2))/(x(17)-x(2))^(3/2)-G*m2*(x(17)-x(8))/(x(13)-x(8))^(3/2);%dry3
%x(18)=-G*m1*(x(18)-x(3))/(x(18)-x(3))^(3/2)-G*m2*(x(18)-x(9))/(x(13)-x(9))^(3/2);%drz3
%two body problem system
%j=((x(7)-x(1))^2+(x(8)-x(2))^2+(x(9)-x(3))^2)^(1/2);
f=@(t,x)[x(4);
    x(5);
    x(6);
    -G*m2*(x(1)-x(7))/((x(1)-x(7))^2+(x(2)-x(8))^2+(x(3)-x(9))^2)^(3/2)-G*m3*(x(1)-x(13))/((x(1)-x(13))^2+(x(2)-x(14))^2+(x(3)-x(15))^2)^(3/2);
    -G*m2*(x(2)-x(8))/((x(1)-x(7))^2+(x(2)-x(8))^2+(x(3)-x(9))^2)^(3/2)-G*m3*(x(2)-x(14))/((x(1)-x(13))^2+(x(2)-x(14))^2+(x(3)-x(15))^2)^(3/2);
    -G*m2*(x(3)-x(9))/((x(1)-x(7))^2+(x(2)-x(8))^2+(x(3)-x(9))^2)^(3/2)-G*m3*(x(3)-x(15))/((x(1)-x(13))^2+(x(2)-x(14))^2+(x(3)-x(15))^2)^(3/2);
    x(10);
    x(11);
    x(12);
    -G*m1*(x(7)-x(1))/((x(7)-x(1))^2+(x(8)-x(2))^2+(x(9)-x(3))^2)^(3/2)-G*m3*(x(7)-x(13))/((x(7)-x(13))^2+(x(8)-x(14))^2+(x(9)-x(15))^2)^(3/2);
    -G*m1*(x(8)-x(2))/((x(7)-x(1))^2+(x(8)-x(2))^2+(x(9)-x(3))^2)^(3/2)-G*m3*(x(8)-x(14))/((x(7)-x(13))^2+(x(8)-x(14))^2+(x(9)-x(15))^2)^(3/2);
    -G*m1*(x(9)-x(3))/((x(7)-x(1))^2+(x(8)-x(2))^2+(x(9)-x(3))^2)^(3/2)-G*m3*(x(9)-x(15))/((x(7)-x(13))^2+(x(8)-x(14))^2+(x(9)-x(15))^2)^(3/2);
    x(16);
    x(17);
    x(18);
    -G*m1*(x(13)-x(1))/((x(13)-x(1))^2+(x(14)-x(2))^2+(x(15)-x(3))^2)^(3/2)-G*m2*(x(13)-x(7))/((x(13)-x(7))^2+(x(14)-x(8))^2+(x(15)-x(9))^2)^(3/2);
    -G*m1*(x(14)-x(2))/((x(13)-x(1))^2+(x(14)-x(2))^2+(x(15)-x(3))^2)^(3/2)-G*m2*(x(14)-x(8))/((x(13)-x(7))^2+(x(14)-x(8))^2+(x(15)-x(9))^2)^(3/2);
    -G*m1*(x(15)-x(3))/((x(13)-x(1))^2+(x(14)-x(2))^2+(x(15)-x(3))^2)^(3/2)-G*m2*(x(15)-x(9))/((x(13)-x(7))^2+(x(14)-x(8))^2+(x(15)-x(9))^2)^(3/2)];

%numerical parameters
h=0.0001;
numsteps=500000;
%initial x0
x0=zeros(18,numsteps);
%x0(:,1)=[0;1;2;1;0;0;0;1;0;0;0;1];
%x0(:,1)=[0;0;0;0;0;0;2;0;0;0;1;0;10000000;0;0;0;0;0];
x0(:,1)=[0;0;0;0;0;0;2;0;0;0;1;0;1;20.0;0;0;-0.15;0];

%initial time
t0=zeros(numsteps,1);

%compute points and store in a 2 by n matrix
for i= 1:numsteps
    %[x0(:,i+1),h]=adaptivelogic(f,t0,h,x0(:,i),tol);%rk4step(f,t0(i),h,x0(:,i));
    x0(:,i+1)=rk4step(f,t0(i),h,x0(:,i));
    t0(i+1)=t0(i)+h;
end
x0';
x0(:,numsteps)';
%vol; % test to see if the system is dissapative
% plot points
hold on;
grid on;
title(['three body problem with time step h=' num2str(h)])
xlabel('x')
ylabel('y')
zlabel('z')
%axis([-20 20 -10 30])
hold on;
scatter3(x0(1,:),x0(2,:),x0(3,:),'.','b')
scatter3(x0(7,:),x0(8,:),x0(9,:),'.','r')
scatter3(x0(13,:),x0(14,:),x0(15,:),'.','g')



